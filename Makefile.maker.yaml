# Configuration file for <https://github.com/sapcc/go-makefile-maker>

metadata:
  url: https://github.com/sapcc/maia

binaries:
  - name:        maia
    fromPackage: .
    installTo:   bin/

golang:
  setGoModVersion: true

dockerfile:
  enabled: yes

golangciLint:
  createConfig: true

githubWorkflow:
  ci:
    enabled: true
    coveralls: true
    prepareMakeTarget: generate

nix:
  extraPackages:
    - go-bindata
    - mockgen

renovate:
  enabled: true
  assignees:
    - notque

reuse:
  annotations:
    - paths:
      - build/*.txt
      - etc/*.conf
      - etc/*.json
      - pkg/*/fixtures/*.json
      - pkg/*/fixtures/*.txt
      - pkg/test/*.json
      - docs/*.png
      - docs/*.svg
      - web/static/vendor/bootstrap-3.3.1/css/*.css
      - web/static/vendor/bootstrap-3.3.1/css/*.map
      - web/static/vendor/bootstrap-3.3.1/fonts/*.eot
      - web/static/vendor/bootstrap-3.3.1/fonts/*.svg
      - web/static/vendor/bootstrap-3.3.1/fonts/*.ttf
      - web/static/vendor/bootstrap-3.3.1/fonts/*.woff
      - web/static/vendor/bootstrap-3.3.1/js/*.js
      - web/static/vendor/eonasdan-bootstrap-datetimepicker/bootstrap-datetimepicker.min.js
      - web/static/vendor/eonasdan-bootstrap-datetimepicker/bootstrap-datetimepicker.min.css
      - web/static/vendor/**/*.js
      - web/static/js/graph_template.handlebar
      - web/static/vendor/rickshaw/*.css
      SPDX-FileCopyrightText: SAP SE or an SAP affiliate company
      SPDX-License-Identifier: Apache-2.0

# TODO only run `go install` when necessary (cf. golangci-lint installation in the autogenerated "prepare-static-check" target)
# TODO replace go-bindata with <https://pkg.go.dev/embed>
verbatim: |
  ifdef DEBUG
    BINDDATA_FLAGS = -debug
  endif

  build/maia: generate
  static-check: generate

  generate: FORCE
    if ! hash mockgen 2>/dev/null; then go install go.uber.org/mock/mockgen@latest; fi
    if ! hash go-bindata 2>/dev/null; then go install github.com/go-bindata/go-bindata/go-bindata@v3.1.2+incompatible; fi
    if ! hash addlicense 2>/dev/null; then go install github.com/google/addlicense@latest; fi

    mockgen --source=pkg/storage/interface.go --destination=pkg/storage/genmock.go --package=storage
    mockgen --source=pkg/keystone/interface.go --destination=pkg/keystone/genmock.go --package=keystone


    go-bindata $(BINDDATA_FLAGS) -pkg ui -o pkg/ui/bindata.go -ignore '(.*\.map|bootstrap\.js|bootstrap-theme\.css|bootstrap\.css)'  web/templates/... web/static/...
    gofmt -s -w ./pkg/ui/bindata.go

    # Add license header to the generated bindata.go file
    addlicense -c "SAP SE" ./pkg/ui/bindata.go

